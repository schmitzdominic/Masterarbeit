% !TEX root = Einfuehrung.tex

\chapter{Cypress Einführung}
Um mit Cypress effektiv Tests zu erstellen, muss erst verstanden werden, wie ein Cypress Projekt grundsätzlich aufgebaut ist. Die in diesem Kapitel beschriebene Struktur wird von Cypress empfohlen. Es ist möglich diese Struktur anzupassen und zu verändern. Im Rahmen dieser Arbeit wird darauf allerdings verzichtet. Zusätzlich werden in diesem Abschnitt die wichtigsten Kommandos erläutert.

\section{Projektstruktur} \label{def:cypress_projektstruktur}
Die von Cypress empfohlene Struktur wird bereits beim ersten Anlegen eines Projektes erstellt. Änderungen können mithilfe des Cypress Test Runners über die Einstellungen konfiguriert werden. 
\newline\newline
Beim ersten Start des Cypress Test Runners kann ein Projektordner ausgewählt werden. Wird ein Ordner gewählt, wird geprüft, ob bereits eine cypress.json Datei vorhanden ist. Diese Datei enthält die Project ID mithilfe dieser das Projekt einer Organisation zugeordnet werden kann (siehe \ref{def:cypress_dashboard}). Ist diese Datei nicht enthalten, erstellt Cypress ein neues Projekt mit der folgenden Struktur:

\begin{figure}[H]
	\centering
	\includegraphics[width=1.0\textwidth]{06_Bilder/cypress_ordner_hierarchie.png}
	\setlength{\abovecaptionskip}{-1em}
	\caption{Cypress Projektstruktur}
	\label{img:cypress_folder}
\end{figure}

Neben einer cypress.json Datei wird der Ordner cypress erstellt, der die Ordner \enquote{fixtures}, \enquote{integration}, \enquote{plugins}, \enquote{screenshots} und \enquote{support} enthält (siehe Abbildung \ref{img:cypress_folder}). Standardmäßig enthält jeder Ordner Beispieldateien.
\newpage

\begin{itemize}
	\item \textbf{fixtures}\\
	Der Ordner fixtures enthält json Dateien. Das Format json ist ein schlankes Datenaustauschformat, dass für Menschen einfach zu lesen und zu schreiben ist \autocite{json}. Cypress verwendet diese Dateien dazu Werte zu speichern, die wiederholt für Tests benötigt werden. Jeder Test kann eine oder mehrere fixtures implementieren, um gespeicherte Werte wiederholt abzurufen.
	
	\lstset{style=cypress, caption={Fixture json Beispiel (Quelle: \autocite{cypress})}, label={lst:fixture_beispiel}}
	\begin{lstlisting}
	{
		"name": "Using fixtures to represent data",
		"email": "hello@cypress.io"
	}
	\end{lstlisting} 
			
	\item \textbf{integration}\\
	Eine der wichtigsten Funktionen übernimmt der Ordner \enquote{integration}. In diesem Ordner werden alle Tests in Form von JavaScript Dateien (.js) gespeichert. Cypress basiert auf der Skriptsprache JavaScript und verwendet diese zur Erstellung von Tests \autocite{cypress}. 
	
	\item \textbf{plugins}\\
	Plugins erlauben dem Benutzer das grundlegende Verhalten von Cypress zu verändern oder zu erweitern. Sie sind eine Nahtstelle, um eigenen benutzerdefinierten Code zu schreiben und diesen während bestimmter Phasen eines Tests auszuführen \autocite{cypress}. 
	
	\item \textbf{screenshots}\\
	Um zu gewährleisten, dass bestimmte Zustände erreicht wurden, können zur Sicherheit Screenshots während des Testablaufs erstellt werden. Ein Screenshot ist eine Momentaufnahme, die in der Regel als Bild gespeichert wird. Dieses Bild wird in dem Ordner \enquote{screenshots} gespeichert und kann entsprechend nach dem Testablauf aufgerufen werden \autocite{cypress}.   
	
	\item \textbf{support}\\
	Innerhalb des Ordners \enquote{support}, befindet sich die Datei index.js. Diese Datei bestimmt, welcher Code automatisch vor jeder Testausführung geladen wird. So können beispielsweise bestimmte Kommandos erstellt, in einer Datei gespeichert und mithilfe der index.js vor jeder Testausführung automatisch geladen werden. So kann ein selbst definiertes Kommando für jeden Test bereitgestellt werden \autocite{cypress}. 
	
\end{itemize}

Im Rahmen dieser Arbeit ist seitens der glomex gewünscht, die in Abbildung \ref{img:cypress_folder} verwendete Struktur beizubehalten. Alle Cypress Tests, die in dieser Arbeit erstellt und ausgeführt werden, verwenden die beschriebene Struktur. 


\section{Blockstrukturen}
Um einen Test zu erstellen, wird eine neue JavaScript Datei (.js) mithilfe Visual Studio Code (siehe Kapitel \ref{def:visual_studio}) innerhalb des \enquote{integration} Ordners (siehe Abbildung \ref{img:cypress_folder}) erstellt. Jeder Cypress Test besitzt eine definierte Struktur. Diese enthält grundlegend einen \enquote{describe Block}, der beschreibt, um was für einen Test es sich handelt. Innerhalb des \enquote{describe Blocks} können nun folgende Konstrukte verwendet werden:

\begin{itemize}
	\item \textbf{it}\\
	Ein sogenannter \enquote{it Block} repräsentiert einen Test. In ihm befinden sich alle Kommandos die zur Abarbeitung des Tests benötigt werden \autocite{cypress}. 
	
	\lstset{style=cypress, caption={it Block}, label={lst:it_block}}
	\begin{lstlisting}
	describe('describe Block', function() {
		it('Demonstriert einen it Block', function() {
			// Hier Kommandos
		})
	})
	\end{lstlisting} 
	
	\item \textbf{context}\\
	\enquote{context Blöcke} enthalten Tests und dienen der Übersichtlichkeit. Aus diesem Grund können \enquote{context Blöcke} \enquote{it Blöcke} und weitere Konstrukte enthalten. Die Aufteilung in \enquote{context Blöcke} hat den Vorteil, dass mithilfe eines \enquote{describe Blocks} ein Gebiet definiert werden kann, in dem mehrere \enquote{Context Blöcke} abgearbeitet werden \autocite{cypress}. 
	\newline\newline 
	Ein Beispiel wäre ein Test eines glomex Video Players. So kann als \enquote{describe Block} \enquote{Player Test} definiert werden. Innerhalb dieses Blocks können nun verschiedene Videoplayer mithilfe der \enquote{context Blöcke} getestet werden. 
	
	\newpage
	
	\lstset{style=cypress, caption={context Block}, label={lst:context_block}}
	\begin{lstlisting}
	describe('Player Test', function() {
	
		context('Flash Player', function() {
			it('Pause Test', function() {
				// Kommandos um Pause im Flash Player zu testen
			})
		})
		
		context('HTML Player', function() {
			it('Pause Test', function() {
				// Kommandos um Pause im HTML Player zu testen
			})
		})
		
	})
	\end{lstlisting} 
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\textwidth]{06_Bilder/cypress_context.png}
		\setlength{\abovecaptionskip}{0em}
		\caption{Cypress Test Struktur}
		\label{img:cypress_context}
	\end{figure}

	\item \textbf{before und beforeEach}\\
	Um Code vor einem oder mehreren Tests auszuführen, werden sogenannte \enquote{before} oder \enquote{beforeEach} Blöcke verwendet. Der Unterschied zwischen diesen beiden Blöcken ist, dass der \enquote{before Block} nur einmalig vor dem nächst folgenden \enquote{it Block} ausgeführt wird. Hingegen wird der \enquote{beforeEach Block} vor jedem \enquote{it Block} der hierarchisch folgt erneut abgearbeitet. Beide Blöcke können in jeder Hierarchieebene verwendet werden.
	
	\newpage
	
	\lstset{style=cypress, caption={before und beforeEach BBlock}, label={lst:before_block}}
	\begin{lstlisting}
	describe('Player Test', function() {
	
		before(function(){
			/*
			Wird nur vor "Flash Player - Pause Test" 
			ausgeführt, da es sich um den nächst
			hierarischen Test handelt.
			*/
		})
	
		beforeEach(function(){
			/* 
			Wird vor jedem hirarisch folgenden Test
			ausgeführt. In diesem Fall vor:
	
			- Flash Player - Pause Test
			- HTML Player - Pause Test 
			*/
		})
	
		context('Flash Player', function() {
			it('Pause Test', function() {
				// Kommandos um Pause im Flash Player zu testen
			})
		})
	
		context('HTML Player', function() {
			it('Pause Test', function() {
				// Kommandos um Pause im HTML Player zu testen
			})
		}) 
	})
	\end{lstlisting} 
\end{itemize}

\section{Wichtige Kommandos}
Tests arbeiten eine Folge von Kommandos sequentiell ab. Cypress stellt eine reihe dieser Kommandos zur Verfügung, von denen jedes eine bestimmte Funktionalität übernimmt. In diesem Abschnitt werden nur Kommandos mit Relevanz für diese Arbeit erläutert. Unter \autocite{cypress} kann eine vollständige Kommandoliste eingesehen werden.

\begin{itemize}
	\item \textbf{cy.visit(URL)}\\
	Mithilfe des \enquote{visit} Befehls wird eine Webseite aufgerufen. \vspace{0.8em}\\
	\textbf{Beispiel:}
	\lstset{style=cypress,caption={Ruft die Webseite \enquote{www.google.de} auf}, label={lst:visit}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.visit(www.google.de)
	\end{lstlisting} 
	
	\item \textbf{cy.wait(Zeit)}\\
	Der Befehl \enquote{wait} pausiert einen Test für eine bestimmte Zeit. Die Zeit wird in Millisekunden angegeben. \vspace{0.8em}\\
	\textbf{Beispiel:}
	\lstset{style=cypress,caption={Wartet eine Sekunde bis der Test fortgeführt wird}, label={lst:wait}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.wait(1000)
	\end{lstlisting} 
	
	\item \textbf{cy.get(Locator)}\\
	Um auf ein Webelement zuzugreifen gibt es den \enquote{get} Befehl. Dieser gibt ein oder mehrere Webelemente einer Webseite zurück. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Gibt einen Playback Button zurück}, label={lst:get}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.get(button[data-qa=playbackButton])
	\end{lstlisting}
	
	\newpage
	
	\item \textbf{.click()}\\
	Es gibt Befehle, die nur mithilfe Weiterer funktionieren. Der Befehl click() klickt ein Webelement. Da das Webelement erst gefunden werden muss, um geklickt werden zu können, wird der Befehl get (siehe Codebeispiel \ref{lst:get}) vorausgesetzt. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Klickt den Playback Button}, label={lst:click}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
	cy.get(button[data-qa=playbackButton]).click()
	\end{lstlisting}
	
	\item \textbf{.should(Bedingung)}\\
	Zusätzlich zum \enquote{get} Befehl können weitere Bedingungen mithilfe des \enquote{should} Befehls angegeben werden, um ein Webelement genau zu spezifizieren. Trifft diese Bedingung nicht innerhalb einer bestimmten Zeit zu, wird der Test mit einem Fehler beendet (siehe \gls{assertion}). \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Sucht nach einem \enquote{sichtbaren} Playback Button}, label={lst:should}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.get(button[data-qa=playbackButton])
			.should('be.visible')
	\end{lstlisting}
	
	\item \textbf{.find(Locator)}\\
	Das Kommando \enquote{find}, findet ein Webelement innerhalb eines Webelements. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Finde \enquote{footer} innerhalb \enquote{article}}, label={lst:find}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.get('.article').find('footer')
	\end{lstlisting}
	
	\item \textbf{cy.screenshot(Name)}\\
	Um einen Screenshot zu erstellen, muss der Befehl \enquote{screenshot} ausgeführt werden. Als Parameter muss ein Name übergeben werden, unter dem dieser gespeichert wird. Der erstellte Screenshot wird in dem Ordner \enquote{screenshots} (siehe Abbildung \ref{img:cypress_folder}) als Bilddatei abgespeichert. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Erstellt ein Bild mit dem Namen \enquote{Bildname} im Ordner \enquote{screenshots}}, label={lst:screenshot}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.screenshot('Bildname')
	\end{lstlisting}
	
	\newpage
		
	\item \textbf{cy.log(Meldung)}\\
	Jeder Test gibt während der Ausführung einen Eventlog aus. Mithilfe des \enquote{log} Befehls kann eine Meldung erzeugt und zur Laufzeit im Eventlog ausgegeben werden. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Schreibt \enquote{Dies ist eine Meldung} in den Log}, label={lst:log}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
	cy.log(Dies ist eine Meldung)
	\end{lstlisting}
	
	\item \textbf{cy.reload()}\\
	Der Befehl \enquote{reload} lädt die Webseite neu, auf der sich der Test Momentan befindet. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Lädt die Seite neu}, label={lst:reload}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.reload()
	\end{lstlisting}
	
	\item \textbf{cy.scrollTo(Position)}\\
	Mithilfe des \enquote{scrollTo} Kommandos scrollt der Test an eine angegebene Position. Es können xy Koordinaten als Position verwendet werden oder direkte Befehle wie etwa top, right, left oder bottom. \vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Scrollt bis an den Anfang (top) der Webseite}, label={lst:reload}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.scrollTo('top')
	\end{lstlisting}
	
	\item \textbf{cy.wrap(subject)}\\
	Der Befehl \enquote{wrap}, zu Deutsch \enquote{wickeln} oder auch \enquote{verpacken} legt ein zu nutzendes Objekt fest. Mithilfe von invoke kann mit dem Objekt interagiert werden.\vspace{0.8em}\\
	\textbf{Beispiel:} 
	\lstset{style=cypress,caption={Holt den Namen \enquote{Jane Lane}}, label={lst:wrap}, aboveskip=0.4em, belowskip=1em, abovecaptionskip=0.4em}
	\begin{lstlisting}
		cy.wrap({ name: "Jane Lane" })
		  .invoke('name').should('eq', 'Jane Lane') // true
	\end{lstlisting}
	
\end{itemize}